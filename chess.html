<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Web Chess Board</title>
<link rel="stylesheet" href="style.css" />
<style>
* {
  box-sizing: border-box;
}
body {
  margin: 0;
  padding: 0;
}
#grid {
  display: grid;
  grid-template-columns: auto;
}
@media only screen and (min-width: 600px) {
  #grid {
    grid-template-columns: auto auto auto;
  }
}
@media only screen and (max-width: 600px) {
  #grid > div:nth-child(3) {
    max-height: calc(100vh - 100vmin);
    overflow-y: auto;
  }
}
</style>
</head>
<body>
<div id="grid">
  <div></div>
  <table class="chess-container">
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
  </table>
  <div>
    <div>
      <label for="load-record">Load chess record file:</label>
      <input type="file" id="load-record" />
    </div>
    <div>
      <label for="load-engine">Load WASM engine:</label>
      <input type="file" id="load-engine" />
    </div>
    <div>
      <label for="game-select">Select game from file:</label>
      <select id="game-select"></select>
    </div>
    <hr />
      <p>Current mode:</p>
      <input type="radio" id="btn-viewmode" name="mode" checked />
      <label for="btn-viewmode">View</label>
      <input type="radio" id="btn-editmode" name="mode" />
      <label for="btn-editmode">Edit</label>
      <input type="radio" id="btn-matchmode" name="mode" />
      <label for="btn-matchmode">Match</label>
    <hr />
    <button id="btn-previous">←</button>
    &#32;
    <span id="step-indicator"><span id="step-count">0</span>/<span id="step-total">0</span></span>
    &#32;
    <button id="btn-next">→</button>
    <div class="popup">
      <button id="image-capture-btn">Capture Image</button>
      <span class="popuptext-below" id="image-capture-popup">Image written to clipboard</span>
    </div>
    <hr />
    <div>
      <label for="textbox-fen">FEN string of current position:</label>
      <input type="text" id="textbox-fen" value="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w - - 0 1" />
      <div class="popup" style="display: inline;">
        <button id="fen-copy-btn">Copy FEN string</button>
        <span class="popuptext-below" id="fen-copy-popup">String copied</span>
      </div>
      <button id="btn-import-fen">Load FEN string</button>
    </div>
    <div>
      <label for="textbox-b64pos">Custom base64 position format:</label>
      <input type="text" id="textbox-b64pos" value="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w - - 0 1" />
      <div class="popup" style="display: inline;">
        <button id="b64pos-copy-btn">Copy base64 position</button>
        <span class="popuptext-below" id="b64pos-copy-popup">String copied</span>
      </div>
      <button id="btn-import-b64pos">Load base64 position</button>
    </div>
    <div>
      <div class="popup" style="display: inline;">
        <button id="textboard-copy-btn">Copy textual board</button>
        <span class="popuptext-below" id="textboard-copy-popup">String copied</span>
      </div>
    </div>
    <div>
      <label for="textbox-b64moves">Base64 move notation:</label>
      <input type="text" id="textbox-b64moves" />
      <button id="btn-import-b64moves">Parse base64 moves</button>
    </div>
    <div>
      <p>Comments:</p>
      <textarea id="textbox-comments"></textarea>
    </div>
  </div>
</div>
<script src="chess.js"></script>
<script type="text/javascript">
"use strict";

let boardEl = document.querySelector("table.chess-container tbody");
let board = new Board();

document.getElementById("image-capture-btn").addEventListener("click", async () => {
  let blob = await board.getImage();
  navigator.clipboard.write([new ClipboardItem({ [blob.type]: blob })]);
  document.getElementById("image-capture-popup").classList.toggle("show");
  setTimeout(() => {
    document.getElementById("image-capture-popup").classList.toggle("show");
  }, 5000);
});

document.getElementById("fen-copy-btn").addEventListener("click", () => {
  navigator.clipboard.writeText(document.getElementById("textbox-fen").value);
  document.getElementById("fen-copy-popup").classList.toggle("show");
  setTimeout(() => {
    document.getElementById("fen-copy-popup").classList.toggle("show");
  }, 5000);
});

document.getElementById("btn-import-fen").addEventListener("click", () => {
  board.importFromFen(document.getElementById("textbox-fen").value);
  document.getElementById("textbox-b64pos").value = board.toBase64String();
  board.drawBoard(boardEl);
});

document.getElementById("b64pos-copy-btn").addEventListener("click", () => {
  navigator.clipboard.writeText(document.getElementById("textbox-b64pos").value);
  document.getElementById("b64pos-copy-popup").classList.toggle("show");
  setTimeout(() => {
    document.getElementById("b64pos-copy-popup").classList.toggle("show");
  }, 5000);
});

document.getElementById("btn-import-b64pos").addEventListener("click", () => {
  board.importFromFen(document.getElementById("textbox-b64pos").value);
  document.getElementById("textbox-fen").value = board.getFENString();
  board.drawBoard(boardEl);
});

document.getElementById("textboard-copy-btn").addEventListener("click", () => {
  navigator.clipboard.writeText(board.toString());
  document.getElementById("textboard-copy-popup").classList.toggle("show");
  setTimeout(() => {
    document.getElementById("textboard-copy-popup").classList.toggle("show");
  }, 5000);
});

document.getElementById("btn-import-b64moves").addEventListener("click", () => {
  board.parseBase64Moves(document.getElementById("textbox-b64moves").value);
});

document.getElementById("btn-import-fen").click();
</script>
</body>
</html>
